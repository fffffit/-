<!DOCTYPE html>
<html lang="en">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>学生信息表</title>
    <link rel="stylesheet" href="./index.css" />
  </head>
  <body>
    <h1>新增学员</h1>
    <form class="info" autocomplete="off">
      姓名：<input type="text" class="uname" name="uname" /> 年龄：<input
        type="text"
        class="age"
        name="age"
      />
      性别:
      <select name="gender" class="gender">
        <option value="男">男</option>
        <option value="女">女</option>
      </select>
      薪资：<input type="text" class="salary" name="salary" /> 就业城市：<select
        name="city"
        class="city"
      >
        <option value="北京">北京</option>
        <option value="上海">上海</option>
        <option value="广州">广州</option>
        <option value="深圳">深圳</option>
        <option value="曹县">曹县</option>
      </select>
      <button class="add">录入</button>
    </form>
    <h1>就业榜</h1>
    <table>
      <thead>
        <tr>
          <th>学号</th>
          <th>姓名</th>
          <th>年龄</th>
          <th>性别</th>
          <th>薪资</th>
          <th>就业城市</th>
          <th>操作</th>
        </tr>
      </thead>
      <tbody>
        <!-- <tr>
                <td>1</td>
                <td>包青天</td>
                <td>22</td>
                <td>男</td>
                <td>10k</td>
                <td>北京</td>
                <td>删除</td>
            </tr> -->
      </tbody>
    </table>

    <script>
      // 1. 读取本地存储的数据   student-data  本地存储的命名
      const data = localStorage.getItem("student-data");
      // console.log(data)

      // 2. 如果有就返回对象，没有就声明一个空的数组  arr 一会渲染的时候用的
      const arr = data ? JSON.parse(data) : [];

      // 3. 渲染模块函数
      const tbody = document.querySelector("tbody");
      function render() {
        const trArr = arr.map(function (item, i) {
          return `
        <tr>
          <td>${item.stuId}</td>
          <td>${item.uname}</td>
          <td>${item.age}</td>
          <td>${item.gender}</td>
          <td>${item.salary}</td>
          <td>${item.city}</td>
          <td>
            <a href="javascript:" data-id=${i}>删除</a>
          </td>
        </tr> 
        `;
        });
        // 因为 trArr 是个数组， 我们不要数组，我们要的是 tr的字符串 join()
        tbody.innerHTML = trArr.join("");
      }
    //   render();

      // 4. 录入模块
      const info = document.querySelector(".info");
      const items = info.querySelectorAll("[name]");
      console.log(items);
      info.addEventListener("submit", function (e) {
        e.preventDefault();
        const obj = {};
        obj.stuId = arr.length ? arr[arr.length - 1].stuId + 1 : 1;
        //遍历表单，一个一个往里填数据
        for (let i = 0; i < items.length; i++) {
          const item = items[i];
          if (items[i].value === "") {
            return alert("输入内容不能为空");
          }
          //键值对
          obj[item.name] = item.value
          console.log(obj);
        }
        arr.push(obj)
        localStorage.setItem('student-data', JSON.stringify(arr))
        render()
        this.reset()
      });

      // 5. 删除模块
      tbody.addEventListener('click',function(e) {
        if (e.target.tagName === 'A') {
            arr.splice(e.target.dataset.id, 1)
            localStorage.setItem('student-data', JSON.stringify(arr))
            render()
        }
      })
    </script>
  </body>
</html>
